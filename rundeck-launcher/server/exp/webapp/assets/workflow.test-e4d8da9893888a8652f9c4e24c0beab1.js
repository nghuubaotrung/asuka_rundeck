var RDWorkflow=Class.create({workflow:null,nodeSteppluginDescriptions:null,wfSteppluginDescriptions:null,initialize:function(a,b){this.workflow=a;Object.extend(this,b)},contextType:function(a){a=this.workflow[RDWorkflow.workflowIndexForContextId(a[0])];if("undefined"!=typeof a){if(a.exec)return"command";if(a.jobref)return"job";if(a.script)return"script";if(a.scriptfile)return"scriptfile";if(a.type)return a.nodeStep?"node-step-plugin plugin":null==a.nodeStep||a.nodeStep?"plugin":"workflow-step-plugin plugin"}return"console"},
renderContextStepNumber:function(a){"string"==typeof a&&(a=RDWorkflow.parseContextId(a));a=""+RDWorkflow.stepNumberForContextId(a[0]);return a+". "},renderContextString:function(a){"string"==typeof a&&(a=RDWorkflow.parseContextId(a));var b="";a=this.workflow[RDWorkflow.workflowIndexForContextId(a[0])];if("undefined"!=typeof a)a.description?b=a.description:a.exec?b="Command":a.jobref?b=(a.jobref.group?a.jobref.group+"/":"")+a.jobref.name:a.script?b="Script":a.scriptfile?b=a.scriptfile:a.type&&(b="Plugin "+
a.type,a.nodeStep&&this.nodeSteppluginDescriptions&&this.nodeSteppluginDescriptions[a.type]?b=this.nodeSteppluginDescriptions[a.type].title||b:!a.nodeStep&&this.wfSteppluginDescriptions&&this.wfSteppluginDescriptions[a.type]&&(b=this.wfSteppluginDescriptions[a.type].title||b));else return"[?]";return b}});
RDWorkflow.unescape=function(a,b,c,d){for(var g=[],e=!1,h=0,k=null;h<a.length;h++){var f=a.charAt(h);if(f==b)e?(g.push(b),e=!1):e=!0;else if(0<=c.indexOf(f))if(e)g.push(f),e=!1;else if(0<=d.indexOf(f)){k=f;break}else g.push(f);else e&&(g.push(b),e=!1),g.push(f)}return{text:g.join(""),bchar:k,rest:h<=a.length-1?a.substring(h+1):null}};RDWorkflow.splitEscaped=function(a,b){for(var c=[],d=a;d;)d=RDWorkflow.unescape(d,"\\",["\\","/"],[b]),c.push(d.text),d=d.rest;return c};
RDWorkflow.contextStringSeparator="/";RDWorkflow.parseContextId=function(a){if(null==a)return null;a=RDWorkflow.splitEscaped(a,RDWorkflow.contextStringSeparator);for(var b=0,c=[],b=0;b<a.length;b++)c.push(a[b]);return c};RDWorkflow.paramsForContextId=function(a){a=a.match(/^(\d+)(e)?(@(.+))?$/);return a[4]?a[4].replace(/\\([/@,=])/g,"$1"):null};RDWorkflow.isErrorhandlerForContextId=function(a){return"e"==a.match(/^(\d+)(e)?(@.+)?$/)[2]?!0:!1};
RDWorkflow.stepNumberForContextId=function(a){a=a.match(/^(\d+)(e)?(@.+)?$/);return a[1]?parseInt(a[1]):null};RDWorkflow.workflowIndexForContextId=function(a){a=RDWorkflow.stepNumberForContextId(a);return null!=a?a-1:null};RDWorkflow.cleanContextId=function(a){a=RDWorkflow.parseContextId(a);for(var b=0;b<a.length;b++)a[b]=RDWorkflow.stepNumberForContextId(a[b]);return a.join(RDWorkflow.contextStringSeparator)};
RDWorkflow.assertObjEq=function(a,b){console.assert(a.length==b.length,a,b);if(a.length!=b.length)return!1;for(var c in a)a.hasOwnProperty(c)&&console.assert(a[c]==b[c],a[c],b[c],"prop "+c);return!0};RDWorkflow.assertArrayEq=function(a,b){console.assert(a.length==b.length,a,b);if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)console.assert(a[c]==b[c],a[c],b[c]);return!0};
RDWorkflow.test=function(){RDWorkflow.assertObjEq(RDWorkflow.unescape("abc/123","\\",["\\","/"],["/"]),{text:"abc",bchar:"/",rest:"123"});RDWorkflow.assertObjEq(RDWorkflow.unescape("abc/123/456","\\",["\\","/"],["/"]),{text:"abc",bchar:"/",rest:"123/456"});RDWorkflow.assertObjEq(RDWorkflow.unescape("a\\/bc/123/456","\\",["\\","/"],["/"]),{text:"a/bc",bchar:"/",rest:"123/456"});RDWorkflow.assertArrayEq(RDWorkflow.splitEscaped("a\\/bc/123/456","/"),["a/bc","123","456"]);RDWorkflow.assertArrayEq(RDWorkflow.splitEscaped("a\\/b@c/1,2=3/4\\\\56",
"/"),["a/b@c","1,2=3","4\\56"]);console.assert("node=a"===RDWorkflow.paramsForContextId("2@node=a"));console.assert("node=a"===RDWorkflow.paramsForContextId("2@node\\=a"));console.assert(2===RDWorkflow.stepNumberForContextId("2@node=a"));console.assert(1===RDWorkflow.workflowIndexForContextId("2@node=a"));console.assert(!1===RDWorkflow.isErrorhandlerForContextId("2@node=a"));console.assert(null===RDWorkflow.paramsForContextId("2"));console.assert(2===RDWorkflow.stepNumberForContextId("2"));console.assert(1===
RDWorkflow.workflowIndexForContextId("2"));console.assert(!1===RDWorkflow.isErrorhandlerForContextId("2"));console.assert(null===RDWorkflow.paramsForContextId("2e"));console.assert(2===RDWorkflow.stepNumberForContextId("2e"));console.assert(1===RDWorkflow.workflowIndexForContextId("2e"));console.assert(!0===RDWorkflow.isErrorhandlerForContextId("2e"));console.assert("blah=c"===RDWorkflow.paramsForContextId("2e@blah=c"));console.assert(2===RDWorkflow.stepNumberForContextId("2e@blah=c"));console.assert(1===
RDWorkflow.workflowIndexForContextId("2e@blah=c"));console.assert(!0===RDWorkflow.isErrorhandlerForContextId("2e@blah=c"));console.assert(1===RDWorkflow.stepNumberForContextId("1e@blah=c"));console.assert(0===RDWorkflow.workflowIndexForContextId("1e@blah=c"));console.assert(!0===RDWorkflow.isErrorhandlerForContextId("1e@blah=c"));RDWorkflow.assertArrayEq(RDWorkflow.parseContextId("1"),["1"]);RDWorkflow.assertArrayEq(RDWorkflow.parseContextId("1/1"),["1","1"]);RDWorkflow.assertArrayEq(RDWorkflow.parseContextId("1/1/1"),
["1","1","1"]);RDWorkflow.assertArrayEq(RDWorkflow.parseContextId("1/2/3"),["1","2","3"]);RDWorkflow.assertArrayEq(RDWorkflow.parseContextId("1e@abc/2/3"),["1e@abc","2","3"]);RDWorkflow.assertArrayEq(RDWorkflow.parseContextId("1/2e@asdf=xyz/3"),["1","2e@asdf=xyz","3"]);RDWorkflow.assertArrayEq(RDWorkflow.parseContextId("2@node=crub\\/dub-1/1"),["2@node=crub/dub-1","1"]);console.assert("1/2/3"===RDWorkflow.cleanContextId("1/2/3"),"wrong value");console.assert("1/2/3"===RDWorkflow.cleanContextId("1e@abc/2/3"),
"wrong value");console.assert("1/2/3"===RDWorkflow.cleanContextId("1/2e@asdf=xyz/3"),"wrong value");var a=new RDWorkflow([{type:"example-node-step",nodeStep:!0,configuration:{example:"whatever"}}],{nodeSteppluginDescriptions:{"example-node-step":{title:"blah"}},wfSteppluginDescriptions:{}});console.assert("blah"===a.renderContextString("1"));a=new RDWorkflow([{type:"example-node-step",nodeStep:!1,configuration:{example:"whatever"}}],{nodeSteppluginDescriptions:{},wfSteppluginDescriptions:{"example-node-step":{title:"blah"}}});
console.assert("blah"===a.renderContextString("1"));a=new RDWorkflow([{type:"example-node-step",nodeStep:!0,configuration:{example:"whatever"}}],{nodeSteppluginDescriptions:{},wfSteppluginDescriptions:{}});console.assert("Plugin example-node-step"===a.renderContextString("1"));a=new RDWorkflow([{type:"example-node-step",nodeStep:!1,configuration:{example:"whatever"}}],{nodeSteppluginDescriptions:{},wfSteppluginDescriptions:{}});console.assert("Plugin example-node-step"===a.renderContextString("1"))};
jQuery(function(){RDWorkflow.test()});