function showError(a){appendHtml($("editerror"),a);$("editerror").show()}function showRowSelected(a,b,c){c=document.getElementsByClassName(c,b);for(b=0;b<c.length;b++)$(c[b]).removeClassName("selected");a&&$(a)&&$(a).addClassName("selected")}var jobEdittedHandler;function _onJobEdit(a){jobEdittedHandler=a}function jobWasEdited(){"function"==typeof jobEdittedHandler&&jobEdittedHandler()}
function postLoadItemEdit(a){a=jQuery(a);a.find("input[type=text]").each(function(a,c){c.observe("keypress",noenter)});0<a.find("input[type=text]").length&&a.find("input[type=text]")[0].focus();a.find("textarea.apply_ace").each(function(a,c){_addAceTextarea(c)})}
function _wfiedit(a,b,c){jobWasEdited();b={num:b,isErrorHandler:c?!0:!1,key:a};getCurSEID()&&(b.scheduledExecutionId=getCurSEID());jQuery("#wfli_"+a).load(_genUrl(appLinks.workflowEdit,b),function(b,c,e){_hideWFItemControls();postLoadItemEdit("#wfli_"+a)})}function _wfiview(a,b,c){b={num:b,edit:!0,key:a,isErrorHandler:c?!0:!1};getCurSEID()&&(b.scheduledExecutionId=getCurSEID());jQuery("#wfli_"+a).load(_genUrl(appLinks.workflowRender,b),_showWFItemControls)}
function _wfisave(a,b,c,d){jobWasEdited();c=jQuery("#"+c+" :input").serialize();jQuery.ajax({type:"POST",url:_genUrl(appLinks.workflowSave),data:c,beforeSend:_ajaxSendTokens.curry("job_edit_tokens"),success:function(c,e,g){e=jQuery("#wfli_"+a);e.html(c);1>e.find("div.wfitemEditForm").size()?(_showWFItemControls(),d&&_hideWFItemControlsAddEH(b)):postLoadItemEdit("#wfli_"+a)}}).success(_ajaxReceiveTokens.curry("job_edit_tokens"))}var newitemElem;
function _wfiaddnew(a,b){jobWasEdited();var c={newitemtype:a,newitemnodestep:b?!0:!1};getCurSEID()&&(c.scheduledExecutionId=getCurSEID());clearHtml("wfnewitem");jQuery("#wfnewtypes").hide();_hideWFItemControls();var d=jQuery("#workflowContent"),f=d.find("ol").first(),e=d.find("ol > li").length;c.key=e;d=jQuery('<li><span></span><div></div><ul class="wfhandleritem" style="display:none"><li></li></ul></li>');1==e%2&&d.addClass("alternate");d.data("wfitemnum",e);d.find("div").attr("id","wfivis_"+e);
d.find("ul").data("wfitemnum",e);d.find("ul li").attr("id","wfli_eh_"+e);f.append(d);newitemElem=d.find("span").first()[0];jQuery(newitemElem).attr("id","wfli_"+e);jQuery(newitemElem).load(_genUrl(appLinks.workflowEdit,c),function(){postLoadItemEdit("#wfli_"+e)})}function _addAceTextarea(a){_setupAceTextareaEditor(a,function(){jobWasEdited()})}
function _wfisavenew(a){jobWasEdited();a=jQuery("#"+a+" :input").serialize();jQuery.ajax({type:"POST",url:_genUrl(appLinks.workflowSave),data:a,beforeSend:_ajaxSendTokens.curry("job_edit_tokens"),success:function(a,c,d){jQuery(newitemElem).html(a);0<jQuery(newitemElem).find(".wfitemEditForm").length?postLoadItemEdit(newitemElem):(a=jQuery(newitemElem.parentNode),a.highlight(),jQuery("#wfnewbutton").show(),_showWFItemControls(),jQuery("#workflowDropfinal").data("wfitemnum",parseInt(a.data("wfitemnum"))+
1),newitemElem=null)}}).success(_ajaxReceiveTokens.curry("job_edit_tokens"))}function _wficancelnew(){jQuery(newitemElem.parentNode).remove();newitemElem=null;jQuery("#wfnewbutton").show();_showWFItemControls()}function _findParentAttr(a,b){return jQuery(a).closest("["+b+"]").attr(b)}function _evtNewStepChooseType(a){a=a.element();a=_findParentAttr(a,"data-step-type");_wfiaddnew(a,!1)}function _evtNewNodeStepChooseType(a){a=a.element();a=_findParentAttr(a,"data-node-step-type");_wfiaddnew(a,!0)}
function _evtNewStepCancel(a){jQuery("#wfnewtypes").hide();jQuery("#wfnewbutton").show()}function _hideWFItemControls(){jQuery("#workflowContent").find("span.wfitemcontrols").hide();jQuery("#wfundoredo,#wfnewbutton").hide()}function _updateEmptyMessage(){0<jQuery("#workflowContent").find("ol li").length?jQuery("#wfempty").hide():jQuery("#wfempty").show()}
function _showWFItemControls(){jQuery("#workflowContent").find("span.wfitemcontrols").show();jQuery("#wfundoredo,#wfnewbutton").show();_updateWFUndoRedo();_enableDragdrop();_updateEmptyMessage()}function _hideWFItemControlsAddEH(a){jQuery("#wfli_"+a).find(".wfitem_add_errorhandler").hide()}function _evtNewEHChooseType(a){a=a.element();var b=_findParentAttr(a,"data-step-type");_wfiaddNewErrorHandler(a,b,null,!1)}
function _evtNewEHNodeStepType(a){a=a.element();var b=_findParentAttr(a,"data-node-step-type");_wfiaddNewErrorHandler(a,b,null,!0)}function _hideAddNewEHLinks(){jQuery("span.wfitem_add_errorhandler").hide()}function _showAddNewEHLinks(){jQuery("span.wfitem_add_errorhandler").show()}function _evtNewEHCancel(a){jQuery(a.element()).closest("ul.wfhandleritem").hide();_hideAddNewEH();_showWFItemControls()}
function _wficancelnewEH(a){jQuery(a).closest("ul.wfhandleritem").hide();a=jQuery(a).closest("ul.wfhandleritem li").first();clearHtml(a[0]);_showWFItemControls()}function _hideAddNewEH(){var a=jQuery("#wfnewtypes"),b=jQuery("#wfnew_eh_types");b.hide();b.detach();a.append(b)}
function _wfishownewErrorHandler(a,b,c){b=jQuery("#wfnew_eh_types");a=jQuery("#wfli_eh_"+a);clearHtml(a[0]);b.detach();a.append(b);var d=jQuery("#wf_strat_node_first").is(":checked");c=!(c&&d);d=b.find(".step_section");c?d.show():d.hide();b.show();a.parent().show();_hideWFItemControls()}
function _wfiaddNewErrorHandler(a,b,c,d){null==c&&(a=jQuery(a).closest("ul.wfhandleritem"),1==a.length&&(c=a.data("wfitemnum")));a="eh_"+c;b={newitemtype:b,key:a,num:c,isErrorHandler:!0,newitemnodestep:d?!0:!1};getCurSEID()&&(b.scheduledExecutionId=getCurSEID());var f=jQuery("#wfli_"+a);_hideAddNewEH();f.load(_genUrl(appLinks.workflowEdit,b),function(){postLoadItemEdit(f)})}function _doMoveItem(a,b){_ajaxWFAction(appLinks.workflowReorder,{fromnum:a,tonum:b,edit:!0})}
function _doRemoveItem(a,b,c){var d={delnum:b,edit:!0,key:a,isErrorHandler:c};jQuery("#wfivis_"+a).fadeOut("fast",function(a){_ajaxWFAction(appLinks.workflowRemove,d)})}function _doUndoWFAction(){_ajaxWFAction(appLinks.workflowUndo,{edit:!0})}function _doRedoWFAction(){_ajaxWFAction(appLinks.workflowRedo,{edit:!0})}function _doResetWFAction(){_ajaxWFAction(appLinks.workflowRevert,{edit:!0})}
function _ajaxWFAction(a,b){jobWasEdited();getCurSEID()&&(b.scheduledExecutionId=getCurSEID());jQuery.ajax({type:"POST",url:_genUrl(a),data:b,beforeSend:_ajaxSendTokens.curry("reqtoken_undo_workflow"),success:function(a,b,f){jQuery("#workflowContent").find("ol").html(a);newitemElem=null;jQuery("#wfnewbutton").show();_showWFItemControls()}})}function _updateWFUndoRedo(){var a={};getCurSEID()&&(a.scheduledExecutionId=getCurSEID());jQuery("#wfundoredo").load(_genUrl(appLinks.workflowRenderUndo,a))}
function moveDragItem(a,b){var c=jQuery(a).data("wfitemnum"),d=jQuery(b).data("wfitemnum");d>c&&--d;_doMoveItem(c,d)}
function _enableDragdrop(){$$("#workflowContent ol>li").each(function(a){new Draggable(a,{revert:"failure",ghosting:!1,constraint:"vertical",handle:"dragHandle",scroll:window,onStart:function(a){$("workflowDropfinal").show()},onEnd:function(a){$("workflowDropfinal").hide()}})});$$("#workflowContent ol>li").each(function(a){Droppables.add(a,{hoverclass:"hoverActive",onDrop:moveDragItem});$(a).addClassName("ready")});$$("#workflowDropfinal").each(function(a){Droppables.add(a,{hoverclass:"hoverActive",
onDrop:moveDragItem});$(a).addClassName("ready")})}function _doRevertAction(a){return"workflow"==a?_doResetWFAction():"opts"==a?_doRevertOptsAction():null}function _doRedoAction(a){return"workflow"==a?_doRedoWFAction():"opts"==a?_doRedoOptsAction():null}function _doUndoAction(a){return"workflow"==a?_doUndoWFAction():"opts"==a?_doUndoOptsAction():null}var newoptli;
function _showOptControls(){$$("#optionsContent .opteditcontrols").each(Element.show);$("optnewbutton").show();_updateOptsUndoRedo();_showOptEmptyMessage();clearHtml("optsload")}function _showOptEmptyMessage(){$("optionsContent").down("ul li")?($("optempty").hide(),$("optheader").show()):($("optempty").show(),$("optheader").hide())}function _hideOptControls(){$$("#optionsContent .opteditcontrols").each(Element.hide);$("optnewbutton").hide();clearHtml("optsload")}
function _updateOptsUndoRedo(){var a={};getCurSEID()&&(a.scheduledExecutionId=getCurSEID());jQuery("#optundoredo").load(_genUrl(appLinks.editOptsRenderUndo,a))}function _configureInputRestrictions(a){$(a).select("input").each(function(a){"text"==a.type&&a.observe("keypress",noenter)});$(a).select("input.restrictOptName").each(function(a){"text"==a.type&&a.observe("keypress",function(a){return controlkeycode(a)||onlychars("[a-zA-Z_0-9.\\t-]",a)})})}
function _isjobScheduled(){return"true"==jQuery("#scheduledTrue:checked").val()}function _optedit(a,b){jobWasEdited();var c={name:a};getCurSEID()&&(c.scheduledExecutionId=getCurSEID());c.jobWasScheduled=_isjobScheduled();$("optsload").loading();jQuery.ajax({type:"GET",url:_genUrl(appLinks.editOptsEdit,c),success:function(a,c,e){jQuery(b).html(a);_hideOptControls();_configureInputRestrictions(b)},failure:function(a,b,c){alert("error: "+b)}})}
function _optview(a,b){var c={name:a,edit:!0};getCurSEID()&&(c.scheduledExecutionId=getCurSEID());c.jobWasScheduled=_isjobScheduled();jQuery(b).load(_genUrl(appLinks.editOptsRender,c),_showOptControls)}
function _optsave(a,b,c){jobWasEdited();$("optsload").loading();jQuery.ajax({type:"POST",url:_genUrl(appLinks.editOptsSave,{jobWasScheduled:_isjobScheduled()}),data:jQuery("#"+a+" :input").serialize(),beforeSend:_ajaxSendTokens.curry(b),success:function(a,b,e){jQuery(c).html(a);1>jQuery(c).find("div.optEditForm").length?(_showOptControls(),jQuery(c).highlight()):(_configureInputRestrictions(c),_hideOptControls())}})}
function _optaddnewIfNone(){var a=$$("#optionsContent ul li");a&&0!=a.length||_optaddnew()}
function _optaddnew(){jobWasEdited();var a={newoption:!0};getCurSEID()&&(a.scheduledExecutionId=getCurSEID());_hideOptControls();var b=$("optionsContent").down("ul"),c=$$("#optionsContent ul li").length;newoptli=new Element("li");1==c%2&&newoptli.addClassName("alternate");newoptli.addClassName("optEntry");var d=new Element("div");d.setAttribute("id","optvis_"+c);newoptli.appendChild(d);b.appendChild(newoptli);$("optsload").loading();jQuery(d).load(_genUrl(appLinks.editOptsEdit,a),null,function(a,
b,c){"success"==b&&(_configureInputRestrictions(d),_hideOptControls());clearHtml("optsload")})}function _optcancelnew(){var a=$("optionsContent").down("ul");$(a).removeChild(newoptli);newoptli=null;_showOptControls()}
function _reloadOpts(){var a={newoption:!0,edit:!0};getCurSEID()&&(a.scheduledExecutionId=getCurSEID());$("optionsContent").down("ul.options");$("optsload").loading();jQuery("#optionsContent").find("ul.options").load(_genUrl(appLinks.editOptsRenderAll,a),function(a,c,d){_showOptControls()})}
function _summarizeOpts(){var a={newoption:!0,edit:!0};getCurSEID()&&(a.scheduledExecutionId=getCurSEID());$("optssummary");$("optsload").loading();jQuery("#optssummary").load(_genUrl(appLinks.editOptsRenderSummary,a),_showOptControls)}
function _optsavenew(a,b){jobWasEdited();var c=jQuery("#"+a+" :input").serialize();$("optsload").loading();jQuery.ajax({type:"POST",url:_genUrl(appLinks.editOptsSave,{jobWasScheduled:_isjobScheduled()}),data:c,beforeSend:_ajaxSendTokens.curry(b),success:function(a,b,c){jQuery(newoptli).html(a);newoptli.down("div.optEditForm")?newoptli.down("div.optEditForm")&&(_configureInputRestrictions(newoptli),_hideOptControls()):($(newoptli).highlight(),newoptli=null,_showOptControls(),_reloadOpts())}})}
function _doRemoveOption(a,b,c){jobWasEdited();var d={name:a,edit:!0};getCurSEID()&&(d.scheduledExecutionId=getCurSEID());$("optsload").loading();jQuery($(b)).slideUp("fast",function(a){jQuery.ajax({type:"POST",url:_genUrl(appLinks.editOptsRemove),data:d,beforeSend:_ajaxSendTokens.curry(c),success:function(a,b,c){jQuery("#optionsContent").find("ul").html(a);_showOptControls()}})})}
function _doUndoOptsAction(){var a={edit:!0};getCurSEID()&&(a.scheduledExecutionId=getCurSEID());jQuery.ajax({type:"POST",url:_genUrl(appLinks.editOptsUndo),data:a,beforeSend:_ajaxSendTokens.curry("reqtoken_undo_opts"),success:function(a,c,d){jQuery("#optionsContent").find("ul").html(a);_showOptControls()}})}
function _doRedoOptsAction(){var a={edit:!0};getCurSEID()&&(a.scheduledExecutionId=getCurSEID());jQuery.ajax({type:"POST",url:_genUrl(appLinks.editOptsRedo),data:a,beforeSend:_ajaxSendTokens.curry("reqtoken_undo_opts"),success:function(a,c,d){jQuery("#optionsContent").find("ul").html(a);_showOptControls()}})}
function _doRevertOptsAction(){var a={edit:!0};getCurSEID()&&(a.scheduledExecutionId=getCurSEID());jQuery.ajax({type:"POST",url:_genUrl(appLinks.editOptsRevert),data:a,beforeSend:_ajaxSendTokens.curry("reqtoken_undo_opts"),success:function(a,c,d){jQuery("#optionsContent").find("ul").html(a);_showOptControls()}})}var jobNameFieldId,jobGroupFieldId;
function jobChosen(a,b){jobWasEdited();jobNameFieldId&&jobGroupFieldId&&(jQuery("#"+jobNameFieldId).val(a),jQuery("#"+jobGroupFieldId).val(b));hideJobChooser()}
function loadJobChooser(a,b,c,d){jQuery(a).hasClass("active")?hideJobChooser():(jobNameFieldId=c,jobGroupFieldId=d,jQuery(a).button("loading").addClass("active"),jQuery.ajax({url:_genUrl(appLinks.menuJobsPicker,{jobsjscallback:"true",runAuthRequired:!0}),success:function(b,c,d){jQuery(a).popover({html:!0,container:"body",placement:"left",content:b,trigger:"manual"}).popover("show");jQuery(a).button("reset")},error:function(b,c,d){showError("Error performing request: menuJobsPicker: "+transport);jQuery(a).button("reset")}}))}
function hideJobChooser(){jQuery(".btn.act_choose_job").removeClass("active").button("reset").popover("hide")}function groupChosen(a){jobWasEdited();jQuery("#schedJobGroup").val(a);jQuery("#schedJobGroup").highlight();jQuery("#groupChooseBtn").popover("hide")}
function loadGroupChooser(){var a=jQuery("#groupChooseBtn");a.button("loading");jQuery("#schedEditFrameworkProject").val();"true"==a.data("grouptreeshown")?(a.popover("hide"),a.button("reset")):jQuery.get(appLinks.scheduledExecutionGroupTreeFragment+"?jscallback=true",function(a){var c=jQuery("#groupChooseBtn");c.popover({html:!0,container:"body",placement:"left",content:a,trigger:"manual"}).popover("show");c.button("reset")})}
jQuery(window).load(function(){jQuery("#groupChooseBtn").click(loadGroupChooser);jQuery("#groupChooseBtn").on("shown.bs.popover",function(a){jQuery("#groupChooseBtn").data("grouptreeshown","true")});jQuery("#groupChooseBtn").on("hide.bs.popover",function(a){jQuery("#groupChooseBtn").data("grouptreeshown","false")})});