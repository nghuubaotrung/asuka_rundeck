var RDWorkflow=Class.create({workflow:null,nodeSteppluginDescriptions:null,wfSteppluginDescriptions:null,initialize:function(a,b){this.workflow=a;Object.extend(this,b)},contextType:function(a){a=this.workflow[RDWorkflow.workflowIndexForContextId(a[0])];if("undefined"!=typeof a){if(a.exec)return"command";if(a.jobref)return"job";if(a.script)return"script";if(a.scriptfile)return"scriptfile";if(a.type)return a.nodeStep?"node-step-plugin plugin":null==a.nodeStep||a.nodeStep?"plugin":"workflow-step-plugin plugin"}return"console"},
renderContextStepNumber:function(a){"string"==typeof a&&(a=RDWorkflow.parseContextId(a));a=""+RDWorkflow.stepNumberForContextId(a[0]);return a+". "},renderContextString:function(a){"string"==typeof a&&(a=RDWorkflow.parseContextId(a));var b="";a=this.workflow[RDWorkflow.workflowIndexForContextId(a[0])];if("undefined"!=typeof a)a.description?b=a.description:a.exec?b="Command":a.jobref?b=(a.jobref.group?a.jobref.group+"/":"")+a.jobref.name:a.script?b="Script":a.scriptfile?b=a.scriptfile:a.type&&(b="Plugin "+
a.type,a.nodeStep&&this.nodeSteppluginDescriptions&&this.nodeSteppluginDescriptions[a.type]?b=this.nodeSteppluginDescriptions[a.type].title||b:!a.nodeStep&&this.wfSteppluginDescriptions&&this.wfSteppluginDescriptions[a.type]&&(b=this.wfSteppluginDescriptions[a.type].title||b));else return"[?]";return b}});
RDWorkflow.unescape=function(a,b,d,c){for(var g=[],e=!1,h=0,k=null;h<a.length;h++){var f=a.charAt(h);if(f==b)e?(g.push(b),e=!1):e=!0;else if(0<=d.indexOf(f))if(e)g.push(f),e=!1;else if(0<=c.indexOf(f)){k=f;break}else g.push(f);else e&&(g.push(b),e=!1),g.push(f)}return{text:g.join(""),bchar:k,rest:h<=a.length-1?a.substring(h+1):null}};RDWorkflow.splitEscaped=function(a,b){for(var d=[],c=a;c;)c=RDWorkflow.unescape(c,"\\",["\\","/"],[b]),d.push(c.text),c=c.rest;return d};
RDWorkflow.contextStringSeparator="/";RDWorkflow.parseContextId=function(a){if(null==a)return null;a=RDWorkflow.splitEscaped(a,RDWorkflow.contextStringSeparator);for(var b=0,d=[],b=0;b<a.length;b++)d.push(a[b]);return d};RDWorkflow.paramsForContextId=function(a){a=a.match(/^(\d+)(e)?(@(.+))?$/);return a[4]?a[4].replace(/\\([/@,=])/g,"$1"):null};RDWorkflow.isErrorhandlerForContextId=function(a){return"e"==a.match(/^(\d+)(e)?(@.+)?$/)[2]?!0:!1};
RDWorkflow.stepNumberForContextId=function(a){a=a.match(/^(\d+)(e)?(@.+)?$/);return a[1]?parseInt(a[1]):null};RDWorkflow.workflowIndexForContextId=function(a){a=RDWorkflow.stepNumberForContextId(a);return null!=a?a-1:null};RDWorkflow.cleanContextId=function(a){a=RDWorkflow.parseContextId(a);for(var b=0;b<a.length;b++)a[b]=RDWorkflow.stepNumberForContextId(a[b]);return a.join(RDWorkflow.contextStringSeparator)};